{"ast":null,"code":"import _defineProperty from\"/home/itsdcsec/falconws/falcon_face/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/itsdcsec/falconws/falcon_face/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/itsdcsec/falconws/falcon_face/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/itsdcsec/falconws/falcon_face/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/itsdcsec/falconws/falcon_face/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/**\n * Code generated using Python\n * @author Raja Reddy\n * Date : 17 Oct 2021\n *\n * Modified By : \n */import{useState,useEffect}from\"react\";import{withRouter,useParams,useHistory}from\"react-router-dom\";import{useForm}from\"react-hook-form\";import axios from'axios';import*as yup from\"yup\";import{yupResolver}from'@hookform/resolvers/yup';import LiveSearch from'../utils/LiveSearch';//import DatePicker  from 'react-datepicker';\n//import \"react-datepicker/dist/react-datepicker.css\";\n//import addDays from 'date-fns/addDays'\nimport Tabs from'react-bootstrap/Tabs';import Tab from'react-bootstrap/Tab';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var schema=yup.object({//dak: yup.object().required('Required'),\n//ifsc: yup.string().required('Required'),\n});var DrEdit=function DrEdit(){var _errors$amount,_errors$demandDate,_errors$demandOrigin;var _useForm=useForm({resolver:yupResolver(schema)}),register=_useForm.register,handleSubmit=_useForm.handleSubmit,setValue=_useForm.setValue,errors=_useForm.formState.errors,clearErrors=_useForm.clearErrors;var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),serverErrors=_useState2[0],setServerErrors=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),entity=_useState4[0],setEntity=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),state=_useState6[0],setState=_useState6[1];var _useState7=useState('page1'),_useState8=_slicedToArray(_useState7,2),key=_useState8[0],setKey=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),emp=_useState10[0],setEmp=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),dakid=_useState12[0],setDakid=_useState12[1];useEffect(function(){var isCancelled=false;console.log(id);if(id!=='new'){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var record;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:record='';_context.next=3;return axios.get('/demandRegisters/drEdit/dts/'+id).then(function(response){record=response.data;if(record.employee!==null)setEmp(record.employee.officerName+\" : \"+record.employee.rank.rankName+\";\"+record.employee.cdaoNo);if(record.dak!=null)setDakid(record.dak.dakidNo);var fields=['id','dak','cdaoNo','checkDigit','cdrNo','advanceType','amount','penalAmt','employee','demandDate','penalDays','demandOrigin','recordStatus','approved','auditorSettlementDate','aaoSettlementDate','aoSettlementDate','totalAdr','settlementRemarks'];fields.forEach(function(field){return setValue(field,record[field]);});}).catch(function(error){//console.log(error);\n//console.log(error.response.status);\n//console.log(error.response.headers);\nif(error.response)setServerErrors(error.response.data.error);else setServerErrors(error.Error);});case 3:if(!isCancelled){setEntity(record);setState(function(prev){return _objectSpread(_objectSpread({},prev),{},{state:record});});}case 4:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData();return function(){isCancelled=true;};}},[id,setValue]);var onSubmit=function onSubmit(data,event){event.preventDefault();console.log(data);if(data.id){axios.put(\"/demandRegisters/drUpdate/\"+data.id,data).then(function(response){if(response.status==200)history.push(\"/demandRegisters\");else setServerErrors(response.data);}).catch(function(error){//console.log(error.response.data);\n//console.log(error.response.status);\n//console.log(error.response.headers);\nsetServerErrors(error.response.data);});}};var onError=function onError(errors,e){return console.log(errors,e);};//All foreign keys. \n// XXXXXX Add search fields and adjust the values as necessary\nvar parentData={dak:{title:\"Dak\",url:\"daks\",searchList:['dakidNo'],//XXXXXXXXX Add search fields here and also in the corresponding repository\nfkEntity:\"dak\"},employee:{title:\"Employee\",url:\"employees\",searchList:['cdaoNo','officerName'],//XXXXXXXXX Add search fields here and also in the corresponding repository\nfkEntity:\"employee\"}};//Callback for child components (Foreign Keys)\nvar callback=function callback(childData){//console.log(\"Parent Callback\");\nsetEntity(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},childData.fk,childData.entity));});setValue(childData.fk,childData.entity);//console.log(errors);\nclearErrors(childData.fk);};var handleInputCdrChange=function handleInputCdrChange(e){console.log(e.target.value);setValue('cdrNo',e.target.value);//\tconsole.log(\"handle input change\");\n};var errorCallback=function errorCallback(err){//console.log(err);\nsetServerErrors(err);};var handleInputChange=function handleInputChange(e){//console.log(e.target.value);\n};var handleButtonClick=function handleButtonClick(e){history.push(\"/adrReviews\");};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-xl mx-auto \",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full w-3/4  mx-auto \",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit,onError),children:[/*#__PURE__*/_jsxs(\"h1\",{children:[id==='new'?'Add':'Update',\" Demand Register\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500\",children:serverErrors}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-0 \",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:emp,readonly:true})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:dakid,readonly:true})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Type of Demand\"}),/*#__PURE__*/_jsxs(\"select\",_objectSpread(_objectSpread({name:\"cdrNo\",className:\"form-control py-0\",onChange:handleInputCdrChange},register(\"cdrNo\")),{},{children:[/*#__PURE__*/_jsx(\"option\",{value:\"select\",children:\"--Select--\"}),/*#__PURE__*/_jsx(\"option\",{value:\"TADATD\",children:\"Temporary Duty\"},\"1\"),/*#__PURE__*/_jsx(\"option\",{value:\"TADAPT\",children:\"Permanent Duty\"},\"2\"),/*#__PURE__*/_jsx(\"option\",{value:\"LTC\",children:\"LTC\"},\"3\")]}))]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Advance Amount\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"text\",name:\"amount\"},register(\"amount\")),{},{readOnly:true})),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500\",children:(_errors$amount=errors.amount)===null||_errors$amount===void 0?void 0:_errors$amount.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Demand Date\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"date\",name:\"demandDate\"},register(\"demandDate\"))),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500\",children:(_errors$demandDate=errors.demandDate)===null||_errors$demandDate===void 0?void 0:_errors$demandDate.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Demand Origin\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"text\",name:\"demandOrigin\"},register(\"demandOrigin\")),{},{readOnly:true})),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500\",children:(_errors$demandOrigin=errors.demandOrigin)===null||_errors$demandOrigin===void 0?void 0:_errors$demandOrigin.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-0 \",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Update\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleButtonClick,children:\"Cancel\"})})]})]})})});};export default withRouter(DrEdit);","map":{"version":3,"sources":["/home/itsdcsec/falconws/falcon_face/src/components/DrEdit.js"],"names":["useState","useEffect","withRouter","useParams","useHistory","useForm","axios","yup","yupResolver","LiveSearch","Tabs","Tab","schema","object","DrEdit","resolver","register","handleSubmit","setValue","errors","formState","clearErrors","id","history","serverErrors","setServerErrors","entity","setEntity","state","setState","key","setKey","emp","setEmp","dakid","setDakid","isCancelled","console","log","fetchData","record","get","then","response","data","employee","officerName","rank","rankName","cdaoNo","dak","dakidNo","fields","forEach","field","catch","error","Error","prev","onSubmit","event","preventDefault","put","status","push","onError","e","parentData","title","url","searchList","fkEntity","callback","childData","fk","handleInputCdrChange","target","value","errorCallback","err","handleInputChange","handleButtonClick","amount","message","demandDate","demandOrigin"],"mappings":"gwBAAA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,UAAT,CAAqBC,SAArB,CAAgCC,UAAhC,KAAkD,kBAAlD,CACA,OAASC,OAAT,KAAwB,iBAAxB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,KAArB,CAEA,OAASC,WAAT,KAA4B,yBAA5B,CACA,MAAOC,CAAAA,UAAP,KAAuB,qBAAvB,CAEA;AACA;AACA;AAEA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,MAAOC,CAAAA,GAAP,KAAgB,qBAAhB,C,wFAEA,GAAMC,CAAAA,MAAM,CAAGL,GAAG,CAACM,MAAJ,CAAW,CACpB;AAIA;AALoB,CAAX,CAAf,CASA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,yEAC6DT,OAAO,CAAC,CACxFU,QAAQ,CAAEP,WAAW,CAACI,MAAD,CADmE,CAAD,CADpE,CACZI,QADY,UACZA,QADY,CACFC,YADE,UACFA,YADE,CACYC,QADZ,UACYA,QADZ,CACmCC,MADnC,UACsBC,SADtB,CACmCD,MADnC,CAC6CE,WAD7C,UAC6CA,WAD7C,gBAKPlB,SAAS,EALF,CAKdmB,EALc,YAKdA,EALc,CAOpB,GAAIC,CAAAA,OAAO,CAAGnB,UAAU,EAAxB,CAPoB,cAQoBJ,QAAQ,CAAC,EAAD,CAR5B,wCAQbwB,YARa,eAQCC,eARD,8BASQzB,QAAQ,CAAC,EAAD,CAThB,yCASb0B,MATa,eASLC,SATK,8BAUM3B,QAAQ,CAAC,EAAD,CAVd,yCAUb4B,KAVa,eAUNC,QAVM,8BAWE7B,QAAQ,CAAC,OAAD,CAXV,yCAWb8B,GAXa,eAWRC,MAXQ,8BAYD/B,QAAQ,CAAC,EAAD,CAZP,0CAYbgC,GAZa,gBAYTC,MAZS,gCAaGjC,QAAQ,CAAC,EAAD,CAbX,2CAabkC,KAba,gBAaPC,QAbO,gBAiBpBlC,SAAS,CAAC,UAAM,CACf,GAAImC,CAAAA,WAAW,CAAG,KAAlB,CACAC,OAAO,CAACC,GAAR,CAAYhB,EAAZ,EACA,GAAIA,EAAE,GAAK,KAAX,CAAkB,SACFiB,CAAAA,SADE,qIACjB,8IACKC,MADL,CACc,EADd,uBAEOlC,CAAAA,KAAK,CAACmC,GAAN,CAAU,+BAAiCnB,EAA3C,EACJoB,IADI,CACC,SAACC,QAAD,CAAc,CACnBH,MAAM,CAAGG,QAAQ,CAACC,IAAlB,CACA,GAAGJ,MAAM,CAACK,QAAP,GAAkB,IAArB,CACCZ,MAAM,CAACO,MAAM,CAACK,QAAP,CAAgBC,WAAhB,CAA4B,KAA5B,CAAkCN,MAAM,CAACK,QAAP,CAAgBE,IAAhB,CAAqBC,QAAvD,CAAgE,GAAhE,CAAoER,MAAM,CAACK,QAAP,CAAgBI,MAArF,CAAN,CACD,GAAGT,MAAM,CAACU,GAAP,EAAY,IAAf,CACCf,QAAQ,CAACK,MAAM,CAACU,GAAP,CAAWC,OAAZ,CAAR,CACD,GAAMC,CAAAA,MAAM,CAAG,CACf,IADe,CACT,KADS,CACD,QADC,CACS,YADT,CACsB,OADtB,CAC8B,aAD9B,CAC6C,QAD7C,CACuD,UADvD,CAEf,UAFe,CAEH,YAFG,CAEU,WAFV,CAEuB,cAFvB,CAEuC,cAFvC,CAEuD,UAFvD,CAGf,uBAHe,CAGS,mBAHT,CAG6B,kBAH7B,CAGgD,UAHhD,CAG2D,mBAH3D,CAAf,CAODA,MAAM,CAACC,OAAP,CAAe,SAAAC,KAAK,QAAIpC,CAAAA,QAAQ,CAACoC,KAAD,CAAQd,MAAM,CAACc,KAAD,CAAd,CAAZ,EAApB,EACC,CAfI,EAgBJC,KAhBI,CAgBE,SAACC,KAAD,CAAW,CACjB;AACA;AACA;AACA,GAAGA,KAAK,CAACb,QAAT,CACClB,eAAe,CAAC+B,KAAK,CAACb,QAAN,CAAeC,IAAf,CAAoBY,KAArB,CAAf,CADD,IAGC/B,CAAAA,eAAe,CAAC+B,KAAK,CAACC,KAAP,CAAf,CACD,CAxBI,CAFP,QA6BC,GAAI,CAACrB,WAAL,CAAkB,CACjBT,SAAS,CAACa,MAAD,CAAT,CACAX,QAAQ,CAAC,SAAA6B,IAAI,wCAAUA,IAAV,MAAgB9B,KAAK,CAAEY,MAAvB,IAAL,CAAR,CACA,CAhCF,sDADiB,4CAoCjBD,SAAS,GACT,MAAO,WAAM,CACZH,WAAW,CAAG,IAAd,CACA,CAFD,CAGA,CAED,CA7CQ,CA6CN,CAACd,EAAD,CAAKJ,QAAL,CA7CM,CAAT,CAgDA,GAAMyC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACf,IAAD,CAAOgB,KAAP,CAAiB,CACjCA,KAAK,CAACC,cAAN,GACAxB,OAAO,CAACC,GAAR,CAAYM,IAAZ,EACA,GAAIA,IAAI,CAACtB,EAAT,CAAa,CACZhB,KAAK,CAACwD,GAAN,CAAU,6BAA+BlB,IAAI,CAACtB,EAA9C,CAAkDsB,IAAlD,EACEF,IADF,CACO,SAACC,QAAD,CAAc,CACnB,GAAGA,QAAQ,CAACoB,MAAT,EAAiB,GAApB,CACCxC,OAAO,CAACyC,IAAR,CAAa,kBAAb,EADD,IAGCvC,CAAAA,eAAe,CAACkB,QAAQ,CAACC,IAAV,CAAf,CACD,CANF,EAOEW,KAPF,CAOQ,SAACC,KAAD,CAAW,CACjB;AACA;AACA;AACA/B,eAAe,CAAC+B,KAAK,CAACb,QAAN,CAAeC,IAAhB,CAAf,CACA,CAZF,EAaA,CAGD,CApBD,CAsBA,GAAMqB,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAAC9C,MAAD,CAAS+C,CAAT,QAAe7B,CAAAA,OAAO,CAACC,GAAR,CAAYnB,MAAZ,CAAoB+C,CAApB,CAAf,EAAhB,CAEA;AACA;AACA,GAAMC,CAAAA,UAAU,CAAG,CAElBjB,GAAG,CAAE,CACJkB,KAAK,CAAE,KADH,CAEJC,GAAG,CAAG,MAFF,CAGJC,UAAU,CAAG,CAAC,SAAD,CAHT,CAGsB;AAC1BC,QAAQ,CAAE,KAJN,CAFa,CASlB1B,QAAQ,CAAE,CACTuB,KAAK,CAAE,UADE,CAETC,GAAG,CAAG,WAFG,CAGTC,UAAU,CAAG,CAAC,QAAD,CAAU,aAAV,CAHJ,CAG8B;AACvCC,QAAQ,CAAE,UAJD,CATQ,CAAnB,CAkBA;AACA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,SAAD,CAAe,CAC/B;AACA9C,SAAS,CAAC,SAAA+B,IAAI,wCAAUA,IAAV,wBAAiBe,SAAS,CAACC,EAA3B,CAAgCD,SAAS,CAAC/C,MAA1C,IAAL,CAAT,CACAR,QAAQ,CAACuD,SAAS,CAACC,EAAX,CAAeD,SAAS,CAAC/C,MAAzB,CAAR,CACA;AACAL,WAAW,CAACoD,SAAS,CAACC,EAAX,CAAX,CACA,CAND,CAQA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACT,CAAD,CAAO,CACnC7B,OAAO,CAACC,GAAR,CAAY4B,CAAC,CAACU,MAAF,CAASC,KAArB,EACA3D,QAAQ,CAAC,OAAD,CAASgD,CAAC,CAACU,MAAF,CAASC,KAAlB,CAAR,CACD;AAGC,CAND,CAOA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,GAAD,CAAS,CAC9B;AACAtD,eAAe,CAACsD,GAAD,CAAf,CACA,CAHD,CAKA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACd,CAAD,CAAO,CAChC;AACA,CAFD,CAGA,GAAMe,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACf,CAAD,CAAM,CAC/B3C,OAAO,CAACyC,IAAR,CAAa,aAAb,EACA,CAFD,CAIA,mBACC,YAAK,SAAS,CAAC,mBAAf,uBACC,YAAK,SAAS,CAAC,wBAAf,uBAEC,cAAM,QAAQ,CAAE/C,YAAY,CAAC0C,QAAD,CAAWM,OAAX,CAA5B,wBACC,sBAAM3C,EAAE,GAAK,KAAP,CAAe,KAAf,CAAuB,QAA7B,sBADD,cAEC,YAAK,SAAS,CAAC,cAAf,UAA+BE,YAA/B,EAFD,cAMG,aAAK,SAAS,CAAC,yBAAf,wBAGC,kCACE,cAAO,IAAI,CAAC,MAAZ,CAAmB,KAAK,CAAEQ,GAA1B,CAA+B,QAAQ,KAAvC,EADF,EAHD,cAMC,kCACE,cAAO,IAAI,CAAC,MAAZ,CAAmB,KAAK,CAAEE,KAA1B,CAAiC,QAAQ,KAAzC,EADF,EAND,cASC,oCACC,yCADD,cAEE,4CAAQ,IAAI,CAAC,OAAb,CAAqB,SAAS,CAAC,mBAA/B,CAAmD,QAAQ,CAAEyC,oBAA7D,EAAuF3D,QAAQ,CAAC,OAAD,CAA/F,6BACC,eAAQ,KAAK,CAAC,QAAd,wBADD,cAEC,eAAgB,KAAK,CAAC,QAAtB,4BAAY,GAAZ,CAFD,cAGC,eAAgB,KAAK,CAAC,QAAtB,4BAAY,GAAZ,CAHD,cAIC,eAAgB,KAAK,CAAC,KAAtB,iBAAY,GAAZ,CAJD,IAFF,GATD,cAsBC,oCACC,yCADD,cAEC,0CAAO,IAAI,CAAC,MAAZ,CAAsB,IAAI,CAAC,QAA3B,EAAwCA,QAAQ,CAAC,QAAD,CAAhD,MAA8D,QAAQ,KAAtE,GAFD,cAIC,YAAK,SAAS,CAAC,cAAf,0BAA+BG,MAAM,CAAC+D,MAAtC,yCAA+B,eAAeC,OAA9C,EAJD,GAtBD,cA+BE,oCACA,sCADA,cAEA,4BAAO,IAAI,CAAC,MAAZ,CAAsB,IAAI,CAAC,YAA3B,EAA4CnE,QAAQ,CAAC,YAAD,CAApD,EAFA,cAIA,YAAK,SAAS,CAAC,cAAf,8BAA+BG,MAAM,CAACiE,UAAtC,6CAA+B,mBAAmBD,OAAlD,EAJA,GA/BF,cAsCC,oCACC,wCADD,cAEC,0CAAO,IAAI,CAAC,MAAZ,CAAsB,IAAI,CAAC,cAA3B,EAA8CnE,QAAQ,CAAC,cAAD,CAAtD,MAA0E,QAAQ,KAAlF,GAFD,cAIC,YAAK,SAAS,CAAC,cAAf,gCAA+BG,MAAM,CAACkE,YAAtC,+CAA+B,qBAAqBF,OAApD,EAJD,GAtCD,GANH,cAyDC,aAAK,SAAS,CAAC,yBAAf,wBACA,YAAK,SAAS,CAAC,MAAf,uBACC,eAAQ,IAAI,CAAC,QAAb,oBADD,EADA,cAKD,YAAK,SAAS,CAAC,MAAf,uBACA,eAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAEF,iBAA/B,oBADA,EALC,GAzDD,GAFD,EADD,EADD,CA2EA,CApND,CAqNA,cAAe/E,CAAAA,UAAU,CAACY,MAAD,CAAzB","sourcesContent":["/**\n * Code generated using Python\n * @author Raja Reddy\n * Date : 17 Oct 2021\n *\n * Modified By : \n */\n\nimport { useState, useEffect } from \"react\";\nimport { withRouter, useParams, useHistory } from \"react-router-dom\";\nimport { useForm } from \"react-hook-form\";\nimport axios from 'axios';\nimport * as yup from \"yup\";\n\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport LiveSearch from '../utils/LiveSearch';\n\n//import DatePicker  from 'react-datepicker';\n//import \"react-datepicker/dist/react-datepicker.css\";\n//import addDays from 'date-fns/addDays'\n\nimport Tabs from 'react-bootstrap/Tabs'\nimport Tab from 'react-bootstrap/Tab'\n\nconst schema = yup.object({\n      //dak: yup.object().required('Required'),\n      \n      \n      \n      //ifsc: yup.string().required('Required'),\n});\n\n\nconst DrEdit = () => {\n\tconst { register, handleSubmit, setValue, formState: { errors }, clearErrors } = useForm({\n\t\tresolver: yupResolver(schema)\n\t});\n\n\tlet { id } = useParams();\n\n\tlet history = useHistory();\n\tconst [serverErrors, setServerErrors] = useState([]);\n\tconst [entity, setEntity] = useState({});\n\tconst [state, setState] = useState({});\n\tconst [key, setKey] = useState('page1');\n\tconst [emp,setEmp]=useState('');\n\tconst [dakid,setDakid]=useState('');\n\t \n\t\n\t\n\tuseEffect(() => {\n\t\tlet isCancelled = false;\n\t\tconsole.log(id);\n\t\tif (id !== 'new') {\n\t\t\tasync function fetchData() {\n\t\t\t\tlet record = '';\n\t\t\t\tawait axios.get('/demandRegisters/drEdit/dts/' + id)\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\trecord = response.data;\n\t\t\t\t\t\tif(record.employee!==null)\n\t\t\t\t\t\t\tsetEmp(record.employee.officerName+\" : \"+record.employee.rank.rankName+\";\"+record.employee.cdaoNo);\n\t\t\t\t\t\tif(record.dak!=null)\n\t\t\t\t\t\t\tsetDakid(record.dak.dakidNo);\n\t\t\t\t\t\tconst fields = [\n\t\t\t\t\t\t'id', 'dak',  'cdaoNo', 'checkDigit','cdrNo','advanceType', 'amount', 'penalAmt', \n\t\t\t\t\t\t'employee', 'demandDate','penalDays' ,'demandOrigin', 'recordStatus', 'approved',\n\t\t\t\t\t\t'auditorSettlementDate','aaoSettlementDate','aoSettlementDate','totalAdr','settlementRemarks'\n\t\t\t\t\t\t  \t\t\n\t\t\t\t\t];\n\t\t\t\t\t \n\t\t\t\t\tfields.forEach(field => setValue(field, record[field]));\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t//console.log(error);\n\t\t\t\t\t\t//console.log(error.response.status);\n\t\t\t\t\t\t//console.log(error.response.headers);\n\t\t\t\t\t\tif(error.response)\n\t\t\t\t\t\t\tsetServerErrors(error.response.data.error);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tsetServerErrors(error.Error);\n\t\t\t\t\t});\n\n\n\t\t\t\tif (!isCancelled) {\n\t\t\t\t\tsetEntity(record);\n\t\t\t\t\tsetState(prev => ({ ...prev, state: record }));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfetchData();\n\t\t\treturn () => {\n\t\t\t\tisCancelled = true;\n\t\t\t};\n\t\t} \n\n\t}, [id, setValue]);\n\n\n\tconst onSubmit = (data, event) => {\n\t\tevent.preventDefault();\n\t\tconsole.log(data);\n\t\tif (data.id) {\n\t\t\taxios.put(\"/demandRegisters/drUpdate/\" + data.id, data)\n\t\t\t\t.then((response) => { \n\t\t\t\t\tif(response.status==200)\n\t\t\t\t\t\thistory.push(\"/demandRegisters\");\n\t\t\t\t\telse\n\t\t\t\t\t\tsetServerErrors(response.data);\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\t//console.log(error.response.data);\n\t\t\t\t\t//console.log(error.response.status);\n\t\t\t\t\t//console.log(error.response.headers);\n\t\t\t\t\tsetServerErrors(error.response.data)\n\t\t\t\t});\n\t\t}  \n\n\t\t\n\t}\n\n\tconst onError = (errors, e) => console.log(errors, e);\n\n\t//All foreign keys. \n\t// XXXXXX Add search fields and adjust the values as necessary\n\tconst parentData = {\n\t\n\t\tdak: {\n\t\t\ttitle: \"Dak\",\n\t\t\turl : \"daks\",\n\t\t\tsearchList : ['dakidNo'], //XXXXXXXXX Add search fields here and also in the corresponding repository\n\t\t\tfkEntity: \"dak\",\n\t\t},\n\t\t \n\t\temployee: {\n\t\t\ttitle: \"Employee\",\n\t\t\turl : \"employees\",\n\t\t\tsearchList : ['cdaoNo','officerName'], //XXXXXXXXX Add search fields here and also in the corresponding repository\n\t\t\tfkEntity: \"employee\",\n\t\t},\n\t\t \n\t}\n\n\t//Callback for child components (Foreign Keys)\n\tconst callback = (childData) => {\n\t\t//console.log(\"Parent Callback\");\n\t\tsetEntity(prev => ({ ...prev, [childData.fk]: childData.entity }));\n\t\tsetValue(childData.fk, childData.entity);\n\t\t//console.log(errors);\n\t\tclearErrors(childData.fk);\n\t};\n\n\tconst handleInputCdrChange = (e) => {\n\t\tconsole.log(e.target.value);\n\t\tsetValue('cdrNo',e.target.value);\n\t//\tconsole.log(\"handle input change\");\n\t\t \n\t\t\n\t};\n\tconst errorCallback = (err) => {\n\t\t//console.log(err);\n\t\tsetServerErrors(err);\n\t}\n\n\tconst handleInputChange = (e) => {\n\t\t//console.log(e.target.value);\n\t};\n\tconst handleButtonClick = (e) =>{\n\t\thistory.push(\"/adrReviews\");\n\t}\n\n\treturn (\n\t\t<div className=\"max-w-xl mx-auto \">\n\t\t\t<div className=\"w-full w-3/4  mx-auto \" >\n\n\t\t\t\t<form onSubmit={handleSubmit(onSubmit, onError)}>\n\t\t\t\t\t<h1 >{id === 'new' ? 'Add' : 'Update'} Demand Register</h1>\n\t\t\t\t\t<div className=\"text-red-500\">{serverErrors}</div>\n\t\t\t\t\t \n\n\t\t\t\t\t \n\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-0 \">\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t<div >\n\t\t\t\t\t\t\t\t\t <input type=\"text\" value={emp} readonly/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div >\n\t\t\t\t\t\t\t\t\t <input type=\"text\" value={dakid} readonly/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label>Type of Demand</label>\n\t\t\t\t\t\t\t\t\t\t<select name=\"cdrNo\" className=\"form-control py-0\" onChange={handleInputCdrChange} {...register(\"cdrNo\")}>\n\t\t\t\t\t\t\t\t\t\t\t<option value=\"select\">--Select--</option>\n\t\t\t\t\t\t\t\t\t\t\t<option key=\"1\" value=\"TADATD\">Temporary Duty</option>\n\t\t\t\t\t\t\t\t\t\t\t<option key=\"2\" value=\"TADAPT\">Permanent Duty</option>\n\t\t\t\t\t\t\t\t\t\t\t<option key=\"3\" value=\"LTC\">LTC</option>\n\t\t\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label>Advance Amount</label>\n\t\t\t\t\t\t\t\t\t<input type=\"text\"    name=\"amount\" {...register(\"amount\")}   readOnly\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div className=\"text-red-500\">{errors.amount?.message}</div>\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t <div>\n\t\t\t\t\t\t\t\t\t<label>Demand Date</label>\n\t\t\t\t\t\t\t\t\t<input type=\"date\"    name=\"demandDate\" {...register(\"demandDate\")}    \n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div className=\"text-red-500\">{errors.demandDate?.message}</div>\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label>Demand Origin</label>\n\t\t\t\t\t\t\t\t\t<input type=\"text\"    name=\"demandOrigin\" {...register(\"demandOrigin\")}   readOnly\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div className=\"text-red-500\">{errors.demandOrigin?.message}</div>\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-0 \">\n\t\t\t\t\t<div className=\"px-2\">\n\t\t\t\t\t\t<button type=\"submit\" >Update</button>   \n\t\t\t\t\t</div>\n\t\t\t\t\t\t \n\t\t\t\t<div className=\"px-2\">\n\t\t\t\t<button type=\"button\" onClick={handleButtonClick} >Cancel</button>\n\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\nexport default withRouter(DrEdit);"]},"metadata":{},"sourceType":"module"}
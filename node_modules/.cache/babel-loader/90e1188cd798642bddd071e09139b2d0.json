{"ast":null,"code":"var _jsxFileName = \"/home/itsdc/java11ws/falcon_face/src/utils/LiveSearch.js\",\n    _s2 = $RefreshSig$();\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport debounce from 'lodash';\nimport { useForm } from \"react-hook-form\";\nimport axios from \"axios\";\nimport * as yup from \"yup\";\nimport useDebouncedSearch from '../utils/useDebouncedSearch';\n/**\n@author Raja Reddy\nOctober 2021\n*/\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst schema = yup.object({\n  fkDisplay: yup.string().required('Required') //age: yup.number().positive().integer().required(),\n\n}).required();\n\nfunction LiveSearch({\n  parentData,\n  parentCallback,\n  fkEntity,\n  errCallback,\n  parentId\n}) {\n  _s2();\n\n  var _s = $RefreshSig$();\n\n  //console.log(parentData);\n  //console.log(parentCallback);\n  //console.log(fkEntity);\n  //const { register, handleSubmit, reset, setValue, getValues, formState: { errors } } = useForm({});\n  const {\n    register,\n    setValue,\n    formState: {\n      errors\n    }\n  } = useForm({});\n  const initialState = {\n    search: '',\n    list: '',\n    showList: false\n  };\n  const [state, setState] = useState(initialState);\n\n  const useSearch = () => {\n    _s();\n\n    return useDebouncedSearch(query => searchAsync(query));\n  };\n\n  _s(useSearch, \"D/XPO8HpaPsJp8MCO3jZB4+u89w=\", false, function () {\n    return [useDebouncedSearch];\n  });\n\n  const searchAsync = async function (query) {\n    console.log(query);\n\n    if (!parentData.preload) {\n      let fetching = false;\n\n      async function fetchData() {\n        if (!fetching) {\n          if (parentId > 0) {\n            await axios.get(`/${parentData.url + \"/\" + parentId}?search=${query}`).then(response => {\n              console.log(query);\n              console.log(response.data);\n              setState(prevState => ({ ...prevState,\n                search: query,\n                showList: true,\n                list: response.data\n              }));\n            }).catch(error => {\n              if (error.response) errCallback(error.response.data.error);else errCallback(error.Error);\n            });\n          } else await axios.get(`/${parentData.url}?search=${query}`).then(response => {\n            console.log(query);\n            console.log(response.data);\n            setState(prevState => ({ ...prevState,\n              search: query,\n              showList: true,\n              list: response.data\n            }));\n          }).catch(error => {\n            if (error.response) errCallback(error.response.data.error);else errCallback(error.Error);\n          });\n        }\n      }\n\n      fetchData();\n      return () => {\n        fetching = true;\n      };\n    } else {\n      // Data already prefetched. Just show the drop down list\n      console.log(state.list);\n      setState(prevState => ({ ...prevState,\n        search: query,\n        showList: true\n      }));\n    }\n  };\n\n  const {\n    inputText,\n    setInputText,\n    searchResults\n  } = useSearch();\n  useEffect(() => {\n    if (fkEntity) {\n      let row = '';\n\n      for (let field of parentData.searchList) {\n        row += fkEntity[field] + \" : \";\n      }\n\n      row = row.substring(0, row.length - 3); // Strip the last :\n      //console.log(row);\n\n      setValue('fkDisplay', row);\n      setState(prevState => ({ ...prevState,\n        search: row\n      }));\n    }\n  }, [fkEntity, setValue]);\n  useEffect(() => {\n    let fetching = false;\n\n    async function fetchData() {\n      if (parentData.preload) {\n        if (!fetching) await axios.get(`/${parentData.url}`).then(response => {\n          console.log(response.data);\n          setState(prevState => ({ ...prevState,\n            //search: query,\n            showList: false,\n            list: response.data\n          }));\n        }).catch(error => {\n          if (error.response) errCallback(error.response.data.error);else errCallback(error.Error);\n        });\n      }\n    }\n\n    fetchData();\n    return () => {\n      fetching = true;\n    };\n  }, []);\n  /*\n  \tconst handleInputChange = (e) => {\n  \t\t//console.log(e);\n  \t\t//console.log(state);\n  \t\tconst search = e.target.value;\n  \t\tif (!parentData.preload) { //Update the list\n  \n  \t\t}\n  \t\tsetState(prevState => ({\n  \t\t\t...prevState,\n  \t\t\tsearch: search,\n  \t\t\tshowList: true,\n  \t\t}));\n  \t};\n  */\n\n  const sendDataToParent = foreignKeyEntity => {\n    parentCallback(foreignKeyEntity);\n  };\n\n  const setValueHandler = item => {\n    let row = \"\";\n\n    for (let field of parentData.searchList) {\n      row += item[field] + \" : \";\n    } //Strip the last ' : '\n\n\n    row = row.substring(0, row.length - 3); //row += item.id;\n\n    console.log(row);\n    setState(prev => ({ ...prev,\n      search: row,\n      showList: false\n    }));\n    setValue('fkDisplay', row); //let dataToParent = { props: { entity: item } };\n\n    let dataToParent = {\n      fk: parentData.fkEntity,\n      entity: item\n    };\n    console.log(\"ValueHandler\");\n    console.log(dataToParent.entity);\n    sendDataToParent(dataToParent);\n  };\n\n  const dropDownList = item => {\n    const dropDownRow = item => {\n      let row = \"\";\n\n      for (let field of parentData.searchList) {\n        row += item[field] + \" : \";\n      } //console.log(row);\n      //Strip the last ':'\n\n\n      row = row.substring(0, row.length - 3);\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ml-4\",\n        children: row\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 11\n      }, this);\n    };\n\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      onClick: () => setValueHandler(item),\n      className: \"border rounded bg-green-500 hover:bg-green-700 text-white font-bold\",\n      children: dropDownRow(item)\n    }, item.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 4\n    }, this);\n  };\n\n  const sorter = (a, b) => {\n    //return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\n    let aRow = \"\";\n    let bRow = \"\";\n\n    for (let field of parentData.searchList) {\n      aRow += a[field];\n      bRow += b[field];\n    }\n\n    return aRow.toLowerCase().localeCompare(bRow.toLowerCase());\n  };\n\n  const multiFieldFilter = item => {\n    let compositeField = \"\";\n\n    for (let field of parentData.searchList) {\n      compositeField += item[field];\n    }\n\n    return compositeField.toLowerCase().indexOf(state.search.toLowerCase()) >= 0;\n  };\n\n  const makeResult = list => {\n    if (!list) return /*#__PURE__*/_jsxDEV(\"li\", {\n      children: \"No results!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 11\n    }, this);\n    const newList = list.filter(multiFieldFilter);\n    if (newList.length) return newList.slice(0, 7) //Get only 7 items\n    .sort((a, b) => sorter(a, b)) //Sort alphabetically\n    .map(dropDownList);\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      children: \"No results!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 10\n    }, this);\n  };\n\n  const handleFocus = event => event.target.select();\n\n  const handleBlur = event => {\n    console.log(\"handle blur live search\" + event.target);\n    ;\n  }; //const handleFocusOut = (event) => ();\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"-px-2 -mx-2\",\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      children: [parentData.title, \" : \", fkEntity ? fkEntity[parentData.searchList[0]] : '']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      name: \"fkDisplay\",\n      ...register(\"fkDisplay\"),\n      placeholder: \"Search\",\n      onBlur: handleBlur,\n      onChange: e => setInputText(e.target.value),\n      onFocus: handleFocus,\n      className: \"form-control py-0 max-w-xs\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 4\n    }, this), state.showList, state.search !== \"\" && state.showList ? /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: makeResult(state.list)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 5\n    }, this) : state.showList && /*#__PURE__*/_jsxDEV(\"span\", {\n      children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 8\n      }, this), \" \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 272,\n    columnNumber: 3\n  }, this);\n}\n\n_s2(LiveSearch, \"jo+ZgzmvfjPslTtTAqWhghhG8Xo=\", false, function () {\n  return [useForm, useSearch];\n});\n\n_c = LiveSearch;\nexport default _c2 = withRouter(LiveSearch);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"LiveSearch\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/home/itsdc/java11ws/falcon_face/src/utils/LiveSearch.js"],"names":["useState","useEffect","useMemo","withRouter","debounce","useForm","axios","yup","useDebouncedSearch","schema","object","fkDisplay","string","required","LiveSearch","parentData","parentCallback","fkEntity","errCallback","parentId","register","setValue","formState","errors","initialState","search","list","showList","state","setState","useSearch","query","searchAsync","console","log","preload","fetching","fetchData","get","url","then","response","data","prevState","catch","error","Error","inputText","setInputText","searchResults","row","field","searchList","substring","length","sendDataToParent","foreignKeyEntity","setValueHandler","item","prev","dataToParent","fk","entity","dropDownList","dropDownRow","id","sorter","a","b","aRow","bRow","toLowerCase","localeCompare","multiFieldFilter","compositeField","indexOf","makeResult","newList","filter","slice","sort","map","handleFocus","event","target","select","handleBlur","title","e","value"],"mappings":"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","sourcesContent":["import { useState, useEffect, useMemo } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport debounce from 'lodash';\n\nimport { useForm } from \"react-hook-form\";\nimport axios from \"axios\";\nimport * as yup from \"yup\";\nimport useDebouncedSearch from '../utils/useDebouncedSearch'\n\n\n/**\n@author Raja Reddy\nOctober 2021\n*/\n\n\nconst schema = yup.object({\n\tfkDisplay: yup.string().required('Required'),\n\t//age: yup.number().positive().integer().required(),\n}).required();\n\n\nfunction LiveSearch({ parentData, parentCallback, fkEntity, errCallback,parentId}) {\n\t//console.log(parentData);\n\t//console.log(parentCallback);\n\t//console.log(fkEntity);\n\t//const { register, handleSubmit, reset, setValue, getValues, formState: { errors } } = useForm({});\n\t\n\tconst { register, setValue, formState: { errors } } = useForm({});\n\n\n\tconst initialState = {\n\t\tsearch: '',\n\t\tlist: '',\n\t\tshowList: false,\n\t}\n\tconst [state, setState] = useState(initialState);\n\t \n\t \n\t \n\n\tconst useSearch = () => useDebouncedSearch(query => searchAsync(query));\n\t\n\t\n\n\tconst searchAsync = async function(query) {\n\t\tconsole.log(query);\n\t\tif (!parentData.preload) {\n\t\t\tlet fetching = false;\n\t\t\tasync function fetchData() {\n\t\t\tif (!fetching){\n\t\t\t\t \n\t\n\t\t\t\tif(parentId>0){\n\t\t\t\t\tawait axios.get(`/${parentData.url+\"/\"+parentId}?search=${query}`)\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconsole.log(query);\n\t\t\t\t\t\tconsole.log(response.data);\n\t\t\t\t\t\tsetState(prevState => ({\n\t\t\t\t\t\t\t...prevState,\n\t\t\t\t\t\t\tsearch: query,\n\t\t\t\t\t\t\tshowList: true,\n\t\t\t\t\t\t\tlist: response.data\n\t\t\t\t\t\t}));\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tif (error.response)\n\t\t\t\t\t\t\terrCallback(error.response.data.error);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\terrCallback(error.Error);\n\t\t\t\t\t});\n\t\t\t\t}else\n\t\t\t\tawait axios.get(`/${parentData.url}?search=${query}`)\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconsole.log(query);\n\t\t\t\t\t\tconsole.log(response.data);\n\t\t\t\t\t\tsetState(prevState => ({\n\t\t\t\t\t\t\t...prevState,\n\t\t\t\t\t\t\tsearch: query,\n\t\t\t\t\t\t\tshowList: true,\n\t\t\t\t\t\t\tlist: response.data\n\t\t\t\t\t\t}));\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tif (error.response)\n\t\t\t\t\t\t\terrCallback(error.response.data.error);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\terrCallback(error.Error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfetchData();\n\t\t\treturn () => {\n\t\t\t\tfetching = true;\n\t\t\t};\n\n\t\t} else { // Data already prefetched. Just show the drop down list\n\t\t\tconsole.log(state.list);\n\t\t\tsetState(prevState => ({\n\t\t\t\t...prevState,\n\t\t\t\tsearch: query,\n\t\t\t\tshowList: true,\n\n\t\t\t}));\n\t\t}\n\t}\n\tconst { inputText, setInputText, searchResults } = useSearch();\n\n\tuseEffect(() => {\n\t\tif (fkEntity) {\n\t\t\tlet row = '';\n\n\t\t\tfor (let field of parentData.searchList) {\n\t\t\t\trow += fkEntity[field] + \" : \";\n\t\t\t}\n\n\t\t\trow = row.substring(0, row.length - 3);// Strip the last :\n\t\t\t//console.log(row);\n\t\t\tsetValue('fkDisplay', row);\n\t\t\tsetState(prevState => ({\n\t\t\t\t...prevState,\n\t\t\t\tsearch: row,\n\t\t\t}));\n\t\t}\n\n\t}, [fkEntity, setValue]);\n\n\n\tuseEffect(() => {\n\t\tlet fetching = false;\n\t\tasync function fetchData() {\n\t\t\tif (parentData.preload) {\n\t\t\t\tif (!fetching)\n\t\t\t\t\tawait axios.get(`/${parentData.url}`)\n\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\tconsole.log(response.data);\n\t\t\t\t\t\t\tsetState(prevState => ({\n\t\t\t\t\t\t\t\t...prevState,\n\t\t\t\t\t\t\t\t//search: query,\n\t\t\t\t\t\t\t\tshowList: false,\n\t\t\t\t\t\t\t\tlist: response.data\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tif (error.response)\n\t\t\t\t\t\t\t\terrCallback(error.response.data.error);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\terrCallback(error.Error);\n\t\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfetchData();\n\t\treturn () => {\n\t\t\tfetching = true;\n\t\t};\n\n\t}, []);\n\n\t/*\n\t\tconst handleInputChange = (e) => {\n\t\t\t//console.log(e);\n\t\t\t//console.log(state);\n\t\t\tconst search = e.target.value;\n\t\t\tif (!parentData.preload) { //Update the list\n\t\n\t\t\t}\n\t\t\tsetState(prevState => ({\n\t\t\t\t...prevState,\n\t\t\t\tsearch: search,\n\t\t\t\tshowList: true,\n\t\t\t}));\n\t\t};\n\t*/\n\n\tconst sendDataToParent = (foreignKeyEntity) => {\n\t\tparentCallback(foreignKeyEntity);\n\t};\n\n\tconst setValueHandler = (item) => {\n\t\tlet row = \"\";\n\t\tfor (let field of parentData.searchList) {\n\t\t\trow += item[field] + \" : \";\n\t\t}\n\t\t//Strip the last ' : '\n\t\trow = row.substring(0, row.length - 3);\n\t\t//row += item.id;\n\t\tconsole.log(row);\n\t\tsetState(prev => ({\n\t\t\t...prev,\n\t\t\tsearch: row,\n\t\t\tshowList: false,\n\t\t}));\n\t\tsetValue('fkDisplay', row);\n\t\t//let dataToParent = { props: { entity: item } };\n\t\tlet dataToParent = { fk: parentData.fkEntity, entity: item };\n\n\t\tconsole.log(\"ValueHandler\");\n\t\tconsole.log(dataToParent.entity);\n\t\tsendDataToParent(dataToParent);\n\t};\n\n\n\n\n\tconst dropDownList = (item) => {\n\t\tconst dropDownRow = (item) => {\n\t\t\tlet row = \"\";\n\t\t\tfor (let field of parentData.searchList) {\n\t\t\t\trow += item[field] + \" : \";\n\t\t\t}\n\t\t\t//console.log(row);\n\t\t\t//Strip the last ':'\n\t\t\trow = row.substring(0, row.length - 3);\n\t\t\treturn <div className=\"ml-4\">{row}</div>;\n\t\t};\n\n\t\treturn (\n\t\t\t<li key={item.id} onClick={() => setValueHandler(item)}\n\t\t\t\tclassName=\"border rounded bg-green-500 hover:bg-green-700 text-white font-bold\">\n\t\t\t\t{dropDownRow(item)}\n\t\t\t</li>\n\t\t);\n\t};\n\n\tconst sorter = (a, b) => {\n\t\t//return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\n\t\tlet aRow = \"\";\n\t\tlet bRow = \"\";\n\t\tfor (let field of parentData.searchList) {\n\t\t\taRow += a[field];\n\t\t\tbRow += b[field];\n\t\t}\n\t\treturn aRow.toLowerCase().localeCompare(bRow.toLowerCase());\n\t};\n\n\tconst multiFieldFilter = (item) => {\n\t\tlet compositeField = \"\";\n\t\tfor (let field of parentData.searchList) {\n\t\t\tcompositeField += item[field];\n\t\t}\n\t\treturn (\n\t\t\tcompositeField\n\t\t\t\t.toLowerCase()\n\t\t\t\t.indexOf(state.search.toLowerCase()) >= 0\n\t\t);\n\t};\n\n\tconst makeResult = (list) => {\n\t\tif (!list)\n\t\t\treturn <li>No results!</li>;\n\t\tconst newList = list.filter(multiFieldFilter);\n\t\tif (newList.length)\n\t\t\treturn newList\n\t\t\t\t.slice(0, 7) //Get only 7 items\n\t\t\t\t.sort((a, b) => sorter(a, b)) //Sort alphabetically\n\t\t\t\t.map(dropDownList);\n\t\treturn <li>No results!</li>;\n\t};\n\n\tconst handleFocus = (event) => event.target.select();\n \n\tconst handleBlur = (event) => {\n\t\tconsole.log(\"handle blur live search\"+event.target);\n\t\t \n\t\t ;\n\t};\n\t//const handleFocusOut = (event) => ();\n\n\treturn (\n\t\t<div className=\"-px-2 -mx-2\">\n\t\t\t<label >{parentData.title} : {fkEntity ? fkEntity[parentData.searchList[0]] : ''}</label>\n\t\t\t{/*}\n\t\t\t<input\n\t\t\t\ttype=\"text\" name=\"fkDisplay\" {...register(\"fkDisplay\")}\n\t\t\t\tonChange={handleInputChange} onFocus={handleFocus}\n\t\t\t\tplaceholder={`Search`}\n\t\t\t\tclassName=\"form-control py-0 \"\n\t\t\t/>\n\t\t\t*/}\n\n\t\t\t<input type=\"text\" name=\"fkDisplay\" {...register(\"fkDisplay\")} placeholder=\"Search\" onBlur={handleBlur}\n\t\t\t\tonChange={e => setInputText(e.target.value)} onFocus={handleFocus}   \n\t\t\t\tclassName=\"form-control py-0 max-w-xs\"\n\t\t\t/>\n\n\t\t\t{state.showList}\n\t\t\t{state.search !== \"\" && state.showList ? (\n\t\t\t\t<ul>{makeResult(state.list)}</ul>\n\t\t\t) : (\n\t\t\t\t\tstate.showList && (\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<br />{\" \"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)\n\t\t\t\t)}\n\t\t</div>\n\t);\n\n}\n\nexport default withRouter(LiveSearch);\n"]},"metadata":{},"sourceType":"module"}